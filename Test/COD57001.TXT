OBJECT Codeunit 57001 Test Add Text Line Encoding
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=;
  }
  PROPERTIES
  {
    Subtype=Test;
    TestPermissions=Disabled;
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      EncodeText@1000 : TextConst 'KOR=가나다라마바사아자차카타파하';
      Assert@1001 : Codeunit 130000;
      StreamReader@1005 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.StreamReader";
      LStreamReader@1004 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.StreamReader";

    [Test]
    PROCEDURE TestAddTextLineWithEncoding@3();
    VAR
      TempBlob@1000 : TEMPORARY Record 99008535;
      LocalBlob@1005 : TEMPORARY Record 99008535;
      OutStream@1001 : OutStream;
      InStream@1002 : InStream;
      LocalInStream@1007 : InStream;
      StreamWriter@1004 : Codeunit 57000;
      LocalOutStream@1003 : OutStream;
    BEGIN

      //SETUP
      TempBlob.INIT;
      TempBlob.INSERT;
      TempBlob.Blob.CREATEOUTSTREAM(OutStream);
      AddTextLineWithEncoding(OutStream,EncodeText,949);
      TempBlob.MODIFY;
      TempBlob.CALCFIELDS(Blob);

      LocalBlob.INIT;
      LocalBlob.INSERT;
      LocalBlob.Blob.CREATEOUTSTREAM(LocalOutStream);
      AddTextLineWithoutEncoding(LocalOutStream,EncodeText);
      LocalBlob.MODIFY;
      LocalBlob.CALCFIELDS(Blob);

      // Execute
      TempBlob.Blob.CREATEINSTREAM(InStream);
      LocalBlob.Blob.CREATEINSTREAM(LocalInStream);

      // Verify the Encoding Text
      Assert.AreNotEqual(ReadTextLineFromStream(InStream),ReadTextLineFromStream(LocalInStream),'Text should be not equal');
    END;

    [Normal]
    LOCAL PROCEDURE AddTextLineWithoutEncoding@10(VAR OutStream@1000 : OutStream;LineText@1001 : Text);
    VAR
      DotNet_StreamWriter@1002 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.StreamWriter";
    BEGIN
      DotNet_StreamWriter := DotNet_StreamWriter.StreamWriter(OutStream);
      DotNet_StreamWriter.WriteLine(LineText);
      DotNet_StreamWriter.Flush;
      DotNet_StreamWriter.Close;
      DotNet_StreamWriter.Dispose;
    END;

    [Normal]
    LOCAL PROCEDURE ReadTextLineFromStream@34(VAR _InStream@1000 : InStream) retValue : Text;
    VAR
      result@1001 : Text;
    BEGIN
      StreamReader := StreamReader.StreamReader(_InStream);
      result := StreamReader.ReadLine();
      StreamReader.Close;
      StreamReader.Dispose;
      EXIT(result);
    END;

    [Normal]
    LOCAL PROCEDURE AddTextLineWithEncoding@1(VAR OutStream@1000 : OutStream;LineText@1001 : Text;CodePage@1003 : Integer);
    VAR
      StreamWriter@1002 : Codeunit 57000;
      Encoding@1004 : Codeunit 57003;
    BEGIN
      Encoding.Encoding(949);
      StreamWriter.StreamWriter(OutStream,Encoding);
      StreamWriter.WriteLine(LineText);
      StreamWriter.Flush;
      StreamWriter.Close;
      StreamWriter.Dispose;
    END;

    BEGIN
    END.
  }
}

